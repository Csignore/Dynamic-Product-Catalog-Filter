<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        header { margin-bottom: 1.5rem; }
        button { margin-left: 0.5rem; }
        #results { margin-top: 1.5rem; display: grid; gap: 0.75rem; }
        .card { border: 1px solid #ccc; padding: 0.75rem; border-radius: 6px; }
        .meta { font-size: 0.85rem; color: #555; }
        label { font-weight: bold; }
    </style>
</head>
<body>
    <header>
        <h1>Dynamic Product Catalog</h1>
        <div>
            <button id="seed-btn">Generate Sample Data</button>
            <span id="seed-status"></span>
        </div>
        <div style="margin-top:1rem;">
            <label for="search">Search products:</label>
            <input id="search" type="text" placeholder="Type to search..." size="40">
        </div>
    </header>
    <section>
        <div id="results"></div>
        <div id="empty" style="color:#777;"></div>
    </section>

    <script>
        const searchInput = document.getElementById('search');
        const resultsContainer = document.getElementById('results');
        const emptyState = document.getElementById('empty');
        const statusSpan = document.getElementById('seed-status');

        async function fetchProducts(url) {
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error('Request failed');
                return await res.json();
            } catch (err) {
                console.error(err);
            statusSpan.textContent = '⚠️ Request failed';
                return { items: [], total: 0 };
            }
        }

        async function refreshList(term = '') {
            const endpoint = term ? `/products/search?q=${encodeURIComponent(term)}` : '/products?limit=50&page=1';
            const data = await fetchProducts(endpoint);
            renderResults(data.items);
            emptyState.textContent = data.total === 0 ? 'No matching products yet. Generate sample data or try another keyword.' : '';
        }

        function renderResults(items) {
            resultsContainer.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <strong>${item.name}</strong>
                    <div class="meta">${item.brand} · ${item.category} · $${item.price}</div>
                    <p>${item.description}</p>
                    <div class="meta">SKU ${item.sku} · Stock ${item.stock}</div>
                `;
                resultsContainer.appendChild(div);
            });
        }

        let debounceTimer;
        searchInput.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => refreshList(searchInput.value.trim()), 250);
        });

        document.getElementById('seed-btn').addEventListener('click', async () => {
            statusSpan.textContent = '⏳ Generating sample data...';
            const res = await fetch('/products/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ count: 120, seed: Date.now() % 10000 })
            });
            const data = await res.json();
            statusSpan.textContent = `✅ Created ${data.created} records`;
            refreshList();
        });

        // initial load
        refreshList();
    </script>
</body>
</html>
